<?php $this->load->view('layout/header.php')?><style>    form.tab-form-demo .tab-pane {      margin: 20px 20px;    }    .no-js #loader { display: none;  }    .js #loader { display: block; position: absolute; left: 100px; top: 0; }    .se-pre-con {      position: fixed;      left: 0px;      top: 0px;      width: 100%;      height: 100%;      z-index: 9999;      background: url(http://150.95.24.212/newhsc/assets/img/Preloader_21.gif) center no-repeat #fff;    }  </style><!-- page content --><div class="se-pre-con"></div><!-- Loading..... --><div class="right_col" role="main" ng-app="AppJS">  <div class="clearfix"></div>           <!-- ####################===  Top ===######################### -->                          <!-- ####################===  End Top ===######################### --> <!-- ####################===  Order list ===######################### --><div class="row" ng-controller="MainCtrl as $ctrl" ng-init="getDataHdr(); getDataLn(); getDataInvoice();">  <div class="col-md-12 col-xs-12">    <div class="x_panel" style="height:100%;">      <div class="row x_title">            <h2><a href="<?=site_url();?>/Part_ctrl/po_hst_inv_manage"><i class="fa fa-list-alt"></i>&nbsp;จ่ายอะไหล่ HST&nbsp;&nbsp;&nbsp;</a>: <?=$po_num;?></h2>                               <ul class="nav navbar-right panel_toolbox">                      <li><a href="<?=site_url();?>/Part_ctrl/po_hst_inv_manage"><i class="glyphicon glyphicon-backward"></i>&nbsp;กลับไป</a></li>                                          </ul>        <div class="clearfix"></div>    </div>    <div class="x_content">            <table class="table table-bordered jambo_table">        <thead align="center">            <tr>              <th>เลขที่ใบสั่งซื้อ</th>              <th>วันที่สั่งซื้อ</th>              <th>ศูนย์บริการ</th>              <th>สถานะ</th>              <th>ราคารวม</th>              <th>ชื่อผู้สั่งซื้อ</th>            </tr>        </thead>        <tbody ng-show="tblPartOrder.length > 0">            <tr ng-repeat="data in tblPartOrder">              <td>{{data.partorder_code}}</td>              <td>{{data.partorder_date}}</td>              <td>{{data.servicecenter_name_th}}</td>              <td align="center">{{data.partorder_type_desc_th}}</td>              <td align="right">{{data.partorder_total_amt | number}}</td>              <td align="center">{{data.created_by}}</td>            </tr>        </tbody>        </table>         <div class="row">        <div class="col-sm-6 m-b-xs">        </div>        <div class="col-sm-6" align="right">          <button type="button" class="btn btn-warning" ng-click="">            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>&nbsp;ดูประวัติ          </button>            <button type="button" class="btn btn-primary" ng-click="EditOrder()" ng-show="tblLnPartOrder.length > 0">            <span class="glyphicon glyphicon-wrench" aria-hidden="true" ></span>&nbsp;จ่ายอะไหล่          </button>                                         </div>        </div>        <!-- Show Data-->        <table class="table table-bordered jambo_table" ng-show="tblLnPartOrder.length > 0 && (tblPartOrder[0].partorder_type == 'CF-HST' || tblPartOrder[0].partorder_type == 'AC')">        <thead align="center">            <tr>              <th>ลำดับ</th>              <th>สินค้า</th>              <th>อะไหล่</th>              <th>ชื่ออะไหล่</th>               <th>ราคาต่อหน่วย</th>              <th>จำนวน</th>              <th>ส่ง</th>              <th>ยกเลิกจากศูนย์</th>              <th>ยกเลิก HST</th>              <th>ค้างส่ง</th>              <th>ราคารวม</th>            </tr>        </thead>        <tbody>            <tr ng-repeat="data in tblLnPartOrder">              <td>{{$index +1}}</td>              <td>{{data.item_code}}</td>              <td>{{data.partmaster_code}}</td>              <td>{{data.partmaster_code_desc}}</td>              <td align="right">{{data.partorderline_amt | number}}</td>              <td align="center">{{data.partorderline_order_qty | number}}</td>              <td align="center">{{data.partorderline_order_ship_qty | number}}</td>              <td align="center">{{data.partorderline_order_cancelSV_qty | number}}&nbsp;<span class="label label-warning" ng-show="data.flag != '0'">รอการอนุมัติ</span></td>              <td align="center">{{data.partorderline_order_cancel_qty | number}}</td>              <td align="center">{{data.partorderline_order_blance_qty | number}}</td>                            <td align="right">{{data.partorderline_total_amt | number}}</td>            </tr>            <tr>              <td colspan="12" align="right"><h3>ยอดรวม : {{getTotaltblPartMaster() | number}} บาท</h3></td>              </tr>        </tbody>        </table> <br><!-- ####################===  Invoice list ===######################### --><div class="row">  <div class="col-md-12 col-xs-12">    <div class="x_panel" style="height:100%;">    <div class="x_title">    <h2><i class="fa fa-cc-visa"></i>&nbsp;รายการ Invoice</h2>    <div class="clearfix"></div>    </div>    <div class="x_content">        <table class="table table-bordered jambo_table">        <thead align="center">            <tr>              <th>ลำดับ</th>              <th>เลขที่ invoice</th>              <th>เลขที่ invoice Ax</th>              <th>เลขที่ส่งของ</th>              <th>วันที่</th>              <th>ผู้ออก Invoice</th>              <th>รายละเอียด</th>              <th>#</th>            </tr>        </thead>        <tbody>            <tr ng-repeat="data in tblInvoice " ng-show="tblInvoice.length > 0">              <td>{{$index +1}}</td>              <td>{{data.partorderinvoice_code}}</td>              <td>{{data.partorderinvoice_invoice_num}}</td>              <td>{{data.transport_code}}</td>              <td align="center">{{data.created_date}}</td>              <td align="center">{{data.created_by}}</td>              <td align="center">               <button type="button" class="btn btn-primary btn-sm" ng-click="openModelGetInvoice(data.partorderinvoice_code)" ><i class="fa fa-search"></i></button>               </td>              <td align="center">              <button type="button" class="btn btn-danger btn-sm">ยกเลิก</button>              </td>            </tr>                    </tbody>        </table>               </div>      </div>    </div></div></div><!-- ####################===  End Invoice list ===######################### --> <!-- Start Template Issue Part --><div class="modal-demo"><script type="text/ng-template" id="myModalContent.html"><div class="modal-header">  <h3 class="modal-title" id="modal-title">ทำรายการจ่ายอะไหล่ : {{invoice}}</h3></div><div class="modal-body" id="modal-body"><form name="myForm">  <div class="form-group" style="width:25%">    <div class="input-group">      <div class="input-group-addon">เลขที่ Invoice AX **</div>      <input type="text" class="form-control" style="width:150px" ng-model="invoice" name="invoice" class="form-control" required>      <div class="input-group-addon" ng-show="myForm.invoice.$touched && myForm.invoice.$invalid"  style="background-color: red;">กรุณากรอกเลขที่ Invoice.</div>    </div>  </div>          <table class="table table-bordered jambo_table">        <thead align="center">            <tr>              <th>สินค้า</th>              <th>อะไหล่</th>              <th>จำนวน</th>              <th>ส่งแล้ว</th>              <th>ยกเลิก</th>              <th>จำนวนที่ส่ง</th>              <th>ค้างส่ง</th>            </tr>        </thead>        <tbody>            <tr ng-repeat="item in tblPartOrderTemp">              <td>{{item.item_code}}</td>              <td>{{item.partmaster_code}}  <span class="label label-warning" ng-show="item.flag != '0'">รอการอนุมัติ</span></td>              <!-- <td>{{item.partmaster_code_desc}}</td> -->              <td align="center">{{item.partorderline_order_qty | number}}</td>              <td align="center">{{item.partorderline_order_ship_qty | number}}</td>              <td align="center">{{item.partorderline_order_cancel_qty | number}}</td>              <td align="center">                     <button type="button" class="btn-xs btn-danger" ng-click="decrementList(item)" ng-show="item.flag != '1'">                      <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>                    </button>                     &nbsp;{{item.partorderline_order_qty_temp | number}}&nbsp;                    <button type="button" class="btn-xs btn-success" ng-click="incrementList(item)" ng-show="item.flag != '1'">                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>                    </button>                                 </td>              <td align="center">{{item.partorderline_order_blance_qty | number}}</td>                        </tr>        </tbody>        </table>         </form>        </div> <!-- End Model Body  -->         <!-- {{$ctrl.items | json}} -->        <div class="modal-footer">            <button class="btn btn-primary" type="button" ng-click="doUpdate()" ng-disabled="myForm.invoice.$invalid">ตกลง</button>            <button class="btn btn-danger" type="button" ng-click="cancel()">ยกเลิก</button>        </div></script></div>  <!-- End Template Issue Part -->   <!-- Start Template Invoice Query --><div class="modal-demo"><script type="text/ng-template" id="InvoiceContent.html"><div class="modal-header">          <div class="row">        <div class="col-sm-6 m-b-xs">        <h3 class="modal-title" id="modal-title">ใบกำกับภาษี : {{tblInvoiceTemp[0].partorderinvoice_invoice_num}}</h3>        </div>        <div class="col-sm-6" align="right">                                        </div>        </div></div><div class="modal-body" id="modal-body"><form name="myForm"><table style="width:100%;" border="0">  <tbody>      <tr style="height: 50px;">          <td class="col-md-1"></td>            <td class="col-md-2" align="right"><label>เลขที่ Invoice Ax :</label></td>            <td colspan="2" class="col-md-3">              <p>{{tblInvoiceTemp[0].partorderinvoice_invoice_num}}</p>            </td>            <td class="col-md-1"></td>      </tr>      <tr style="height: 50px;">            <td class="col-md-1"></td>            <td class="col-md-2" align="right"><label>เลขที่ Invoice :</label></td>            <td class="col-md-3">              {{tblInvoiceTemp[0].partorderinvoice_code}}            </td>            <td class="col-md-2" align="right"><label>เลขที่ใบสั่งซื้อ :</label></td>            <td class="col-md-3">              {{tblInvoiceTemp[0].partorder_code}}            </td>            <td class="col-md-1"></td>      </tr>      <tr style="height: 50px;">            <td class="col-md-1"></td>            <td class="col-md-2" align="right"><label>วันที่ออกเอกสาร :</label></td>            <td class="col-md-3">             {{tblInvoiceTemp[0].created_date}}            </td>            <td class="col-md-2" align="right"><label>ผู้ออกเอกสาร :</label></td>            <td class="col-md-3">             {{tblInvoiceTemp[0].created_by}}            </td>            <td class="col-md-1"></td>      </tr>                               </tbody></table>          <table class="table table-bordered jambo_table">        <thead align="center">            <tr>              <th>ลำดับ</th>              <th>อะไหล่</th>              <th>จำนวนที่ส่ง</th>            </tr>        </thead>        <tbody>            <tr ng-repeat="item in tblInvoiceTemp">              <td>{{$index +1}}</td>              <td>{{item.partmaster_code}}</td>              <td align="center">{{item.partorderinvoice_ship_qty | number}}</td>            </tr>        </tbody>        </table>         </form>        </div> <!-- End Model Body  -->         <!-- {{$ctrl.items | json}} -->        <div class="modal-footer">          <!--   <button class="btn btn-primary" type="button" ng-click="doUpdate()" ng-disabled="myForm.invoice.$invalid">ตกลง</button> -->            <button class="btn btn-danger" type="button" ng-click="cancel()">ปิด</button>        </div></script></div>  <!-- End Template Invoice Query -->            </div><!--  End Content Main -->    </div>    </div></div><!-- ####################===  End Order list ===######################### -->           </div>  </div></div></div></body></html><script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.js"></script><script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-animate.js"></script><script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-sanitize.js"></script><script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.js"></script><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script><script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"></script><script>   var site = '<?=site_url();?>';  // Animate loader off screen  $(window).load(function() {$(".se-pre-con").fadeOut("slow");});  var AppJS = angular.module('AppJS', ['ngAnimate','ngSanitize','ui.bootstrap']);  //app = angular.module('ui.bootstrap.demo').controller('DatepickerPopupDemoCtrl', function ($scope,$http,$uibModal, $log, $document) {  AppJS.controller('MainCtrl', ['$scope','$http','$uibModal', '$log', '$document','$uibModal','$timeout', function ($scope,$http,$uibModal, $log, $document, $uibModal, $timeout)  {      $scope.limitOrder = 5;                $scope.getDataHdr = function(){              $http.get(site+"/part_ctrl/getHdrListPurchaseHST/<?=$po_num;?>")      .then(function(response)         {           $scope.tblPartOrder = response.data.data;             //console.log(response.data.data);        },function(response) {             console.log('tblPartOrder Error');      });          $timeout(function(){            $scope.getDataHdr();            $scope.getDataLn();            $scope.getDataInvoice();            //$scope.tblPartOrderTemp();          },5000);      }      $scope.getDataLn = function(){          $http.get(site+"/part_ctrl/getLnListPurchaseHST/<?=$po_num;?>")          .then(function(response)             {                            $scope.tblLnPartOrder = response.data.data;             // ----- Check SV Cencel ------             $scope.EnableEdit = false;               $scope.tblLnPartOrder.forEach(function(data){                 if(data.flag > 0 ){                     return $scope.EnableEdit = true;                  }              });             // -----      End        ------            },function(response) {                 console.log('tblPartOrder Error');          });      }      $scope.getDataInvoice= function(){          $http.get(site+"/part_ctrl/getInvoiceList/<?=$po_num;?>")          .then(function(response)             {                            $scope.tblInvoice = response.data.data;            },function(response) {                 console.log('tblPartOrder Error');          });      }      $scope.getInvoiceListDetail= function(inv_num){          $http.get(site+"/part_ctrl/getInvoiceListDetail/"+inv_num)          .then(function(response)             {                            $scope.tblInvoiceDetail = response.data.data;            },function(response) {                 console.log('tblInvoiceDetail Error');          });      }      $scope.tblLnPartOrder = {};      $scope.getTotaltblPartMaster = function(){          var total = 0;          for(var i = 0; i < $scope.tblLnPartOrder.length; i++){              var price = $scope.tblLnPartOrder[i];              total = total + (price.partorderline_total_amt*1);          }          return total;      }      // model       var $ctrl = this;      $ctrl.items = '';      $scope.EditOrder = function(data){        $scope.openModelsetInvoice('lg');      }    $scope.animationsEnabled = true;  //SET ANIMATION    $scope.openModelsetInvoice = function (size) {    var modalInstance = $uibModal.open({      animation: $scope.animationsEnabled,      templateUrl: 'myModalContent.html',      controller: 'ModalInstanceCtrl',      size: size,      resolve: {        items: function () {          return $scope.tblLnPartOrder;        }      }    });    modalInstance.result.then(function () {      //alert("OK");      $scope.getDataHdr();      $scope.getDataLn();      $scope.getDataInvoice();    }, function () {      $scope.getDataHdr();      $scope.getDataLn();      $scope.getDataInvoice();      $log.info('Modal dismissed at: ' + new Date());    });    };    $scope.openModelGetInvoice = function (item) {    // $scope.getInvoiceListDetail(item);          $http.get(site+"/part_ctrl/getInvoiceListDetail/"+item)          .then(function(response)             {                            $scope.tblInvoiceDetail = response.data.data;              var modalInstance = $uibModal.open({              animation: $scope.animationsEnabled,              templateUrl: 'InvoiceContent.html',              controller: 'InvoiceContentCtrl',              size: 'lg',              resolve: {                items: function () {                  return $scope.tblInvoiceDetail;                }              }              });              modalInstance.result.then(function () {                //alert("OK");                $scope.getDataHdr();                $scope.getDataLn();                $scope.getDataInvoice();              }, function () {                $scope.getDataHdr();                $scope.getDataLn();                $scope.getDataInvoice();                $log.info('Modal dismissed at: ' + new Date());              });            },function(response) {                 console.log('tblInvoiceDetail Error');          });    //   var modalInstance = $uibModal.open({    //   animation: $scope.animationsEnabled,    //   templateUrl: 'InvoiceContent.html',    //   controller: 'InvoiceContentCtrl',    //   size: 'lg',    //   resolve: {    //     items: function () {    //       return $scope.tblInvoiceDetail;    //     }    //   }    // });    // modalInstance.result.then(function () {    //   //alert("OK");    //   $scope.getDataHdr();    //   $scope.getDataLn();    //   $scope.getDataInvoice();    // }, function () {    //   $scope.getDataHdr();    //   $scope.getDataLn();    //   $scope.getDataInvoice();    //   $log.info('Modal dismissed at: ' + new Date());    // });  };       // =================================================================  }]);// POPUPangular.module('AppJS').controller('ModalInstanceCtrl', function ($scope, $uibModalInstance, items, $http) {  $scope.tblPartOrderTemp = items;  $scope.ok = function () {    $uibModalInstance.close($scope.selected.item);  };  $scope.cancel = function () {    $uibModalInstance.dismiss('cancel');  };  $scope.doUpdate = function () {      var request = $http({      method: "post",      url: site+"/part_ctrl/prcInvoiceAxHST",      data: {              data: $scope.tblPartOrderTemp,              invoice: $scope.invoice      },      headers: { 'Content-Type': 'application/x-www-form-urlencoded' }      });      request.then(function (response) {                    $uibModalInstance.close();      },function(response) {          console.log(response);          console.log($scope.tblPartOrderTemp);      });      //console.log($scope.tblPartOrderTemp);     // console.log($scope.invoice);      };  $scope.incrementList = function(part){     var qty   = 0;     var blance   = 0;      qty   =  part.partorderline_order_qty_temp;      qty++;      blance   =  (parseInt(part.partorderline_order_qty)-(parseInt(part.partorderline_order_ship_qty)+parseInt(part.partorderline_order_cancel_qty)+qty));    if((blance >= 0) && (qty >=0)){              part.partorderline_order_qty_temp++;            part.partorderline_order_blance_qty = (parseInt(part.partorderline_order_qty)-(parseInt(part.partorderline_order_ship_qty)+parseInt(part.partorderline_order_cancel_qty)+qty));            part.status = 1;    }  }  $scope.decrementList = function(part){     var qty   = 0;     var blance   = 0;      qty   =  part.partorderline_order_qty_temp;      qty--;     blance   =  (parseInt(part.partorderline_order_qty)-(parseInt(part.partorderline_order_ship_qty)+parseInt(part.partorderline_order_cancel_qty)+qty));    if((blance >= 0) && (qty >=0)){              part.partorderline_order_qty_temp--;            part.partorderline_order_blance_qty = (parseInt(part.partorderline_order_qty)-(parseInt(part.partorderline_order_ship_qty)+parseInt(part.partorderline_order_cancel_qty)+qty));            part.status = 1;    }  }}); angular.module('AppJS').controller('InvoiceContentCtrl', function ($scope, $uibModalInstance, items, $http) {  $scope.tblInvoiceTemp = items;  $scope.EditInvoice = false;  $scope.ok = function () {    $uibModalInstance.close();  };  $scope.cancel = function () {    $uibModalInstance.dismiss('cancel');  }; }); AppJS.directive('ngConfirmClick', [    function(){        return {            link: function (scope, element, attr) {                var msg = attr.ngConfirmClick || "Are you sure?";                var clickAction = attr.confirmedClick;                element.bind('click',function (event) {                    if ( window.confirm(msg) ) {                        scope.$eval(clickAction)                    }                });            }        };}])</script>  <!-- /page content --><?php $this->load->view('layout/footer.php')?>